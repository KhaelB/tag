!function(){"use strict";class t{constructor(){this.settings=null,window.aspaSettings?this.validateAndSet(window.aspaSettings):console.error("Aspa Chat: window.aspaSettings object not found.")}validateAndSet(t){var e,n,o,i,s,a,r;if(t.customerId){if(this.settings={customerId:t.customerId,floatingButton:t.floatingButton?this.normalizeConfig(t.floatingButton):void 0,configurations:{},fallback:{phoneNumber:(null===(e=t.fallback)||void 0===e?void 0:e.phoneNumber)||"",message:(null===(n=t.fallback)||void 0===n?void 0:n.message)||""},conversion:{defaultValue:(null===(o=t.conversion)||void 0===o?void 0:o.defaultValue)||1,currency:(null===(i=t.conversion)||void 0===i?void 0:i.currency)||"BRL",eventName:(null===(s=t.conversion)||void 0===s?void 0:s.eventName)||"generate_lead",eventSource:(null===(a=t.conversion)||void 0===a?void 0:a.eventSource)||"aspa_chat_form",eventValue:(null===(r=t.conversion)||void 0===r?void 0:r.eventValue)||"value"}},t.configurations)for(const[e,n]of Object.entries(t.configurations))this.settings.configurations[e]=this.normalizeConfig(n)}else console.error("Aspa Chat: customerId is missing.")}normalizeConfig(t){var e,n,o,i,s,a;return{formId:t.formId,dialogType:t.dialogType||"floating",triggerSelector:t.triggerSelector||"",delay:t.delay,styles:{buttonColor:(null===(e=t.styles)||void 0===e?void 0:e.buttonColor)||"#25D366",iconColor:(null===(n=t.styles)||void 0===n?void 0:n.iconColor)||"#ffffff",modalColor:(null===(o=t.styles)||void 0===o?void 0:o.modalColor)||"#ffffff",borderRadius:(null===(i=t.styles)||void 0===i?void 0:i.borderRadius)||"20px"},fallback:{phoneNumber:(null===(s=t.fallback)||void 0===s?void 0:s.phoneNumber)||"",message:(null===(a=t.fallback)||void 0===a?void 0:a.message)||""}}}getSettings(){return this.settings}getConfig(t){return this.settings?"floating"===t&&this.settings.floatingButton?this.settings.floatingButton:this.settings.configurations[t]||null:null}}class e{constructor(){this.ATTR_KEY="aspa_attribution_history",this.ACCUMULATED_KEY="aspa_accumulated_attribution",this.SESSION_KEY="aspa_active_session",this.isVisible=!0,this.initSession(),this.initListeners(),this.startTracking()}init(){this.processAttribution()}initSession(){const t=sessionStorage.getItem(this.SESSION_KEY),e=Date.now(),n={url:window.location.href,title:document.title,timeOnPage:0,clickCount:0,scrollDepth:0,timestamp:e};if(this.getAccumulatedAttribution(),t)try{if(this.session=JSON.parse(t),this.session.activePage&&this.session.pageHistory.push(this.session.activePage),this.session.pageHistory.length>50){const t=this.session.pageHistory.length-50;this.session.pageHistory.splice(0,t)}this.session.activePage=n,this.session.lastActive=e}catch(t){this.startNewSession(n)}else this.startNewSession(n);this.saveSession()}startNewSession(t){this.session={sessionId:this.generateUUID(),startTime:Date.now(),lastActive:Date.now(),entryPage:t.url,referrer:document.referrer||"",totalClicks:0,totalTime:0,pageHistory:[],activePage:t}}initListeners(){let t;document.addEventListener("visibilitychange",()=>{this.isVisible=!document.hidden}),document.addEventListener("click",()=>{var t;(null===(t=this.session)||void 0===t?void 0:t.activePage)&&(this.session.activePage.clickCount++,this.session.totalClicks++)}),window.addEventListener("scroll",()=>{t||(t=setTimeout(()=>{var e;const n=window.scrollY,o=document.body.scrollHeight-window.innerHeight,i=o>0?Math.round(n/o*100):0;(null===(e=this.session)||void 0===e?void 0:e.activePage)&&i>this.session.activePage.scrollDepth&&(this.session.activePage.scrollDepth=i),t=null},500))}),window.addEventListener("beforeunload",()=>{this.saveSession()})}startTracking(){this.timerInterval=setInterval(()=>{var t;this.isVisible&&(null===(t=this.session)||void 0===t?void 0:t.activePage)&&(this.session.activePage.timeOnPage++,this.session.totalTime++,this.session.lastActive=Date.now())},1e3),this.saveInterval=setInterval(()=>{this.saveSession()},5e3)}saveSession(){this.session&&sessionStorage.setItem(this.SESSION_KEY,JSON.stringify(this.session))}processAttribution(){const t=new URLSearchParams(window.location.search);let e=new URLSearchParams;if(window.location.hash.includes("?")){const t=window.location.hash.split("?")[1];e=new URLSearchParams(t)}const n={},o=["gclid","fbclid","ttclid","wbraid","gbraid"],i=t=>{t.forEach((t,e)=>{(o.includes(e)||e.startsWith("utm_"))&&(n[e]=t)})};if(i(t),i(e),!n.gclid){const t=this.checkGoogleCookies();t&&(n.gclid=t)}if(0===Object.keys(n).length)return;const s={timestamp:Date.now(),params:n},a=this.getAttributionHistory();a.push(s),a.length>20&&a.shift();try{localStorage.setItem(this.ATTR_KEY,JSON.stringify(a))}catch(t){console.error("[Aspa Tag] LocalStorage Error",t)}this.updateAccumulatedAttribution(n)}checkGoogleCookies(){try{const t=document.cookie.match(/_gcl_aw=([^;]+)/g);if(!t||0===t.length)return null;let e=0,n=null;return t.forEach(t=>{var o;const i=null===(o=t.split("=")[1])||void 0===o?void 0:o.trim();if(!i)return;const s=i.split(".");if(s.length>=3){const t=s[s.length-2],o=s[s.length-1],i=parseInt(t,10);!isNaN(i)&&i>e&&(e=i,n=o)}}),n}catch(t){return null}}updateAccumulatedAttribution(t){let e=this.getAccumulatedAttribution();e=Object.assign(Object.assign({},e),t);try{localStorage.setItem(this.ACCUMULATED_KEY,JSON.stringify(e))}catch(t){}this.session&&this.saveSession()}getSessionData(){return this.session}getAttributionHistory(){try{const t=localStorage.getItem(this.ATTR_KEY);return t?JSON.parse(t):[]}catch(t){return[]}}getAccumulatedAttribution(){try{const t=localStorage.getItem(this.ACCUMULATED_KEY);return t?JSON.parse(t):{}}catch(t){return{}}}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}}class n{constructor(){this.backendUrl="https://aspa-tag.web.app/send/v1"}async sendSubmission(t){try{if(!t.phone)throw new Error("Phone number is missing.");return fetch(this.backendUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"omit"}).then(t=>!!t.ok||409===t.status&&"ALREADY_SUBMITTED_TODAY").catch(t=>(console.log(t),t))}catch(t){return console.error("[Aspa Tag] API Error",t),t}}}class o{constructor(t,e,n,o){this.apiService=t,this.environmentService=e,this.settingsService=n,this.conversionService=o,this.modalIframeWindow=null,this.trustedOrigins=["https://aspa-form.web.app"]}init(){window.addEventListener("message",this.handleMessage.bind(this))}setModalIframe(t){this.modalIframeWindow=t}postMessage(t,e){t.postMessage(e,"https://aspa-form.web.app")}sendInitialConfig(t,e,n,o){const i={source:"asp-tag",event:"initial-config",payload:{parentOrigin:window.location.origin,fallbackPhone:e,fallbackMessage:n||"",themeColor:o||"#00BFA5"}};this.postMessage(t,i)}sendContext(t){const e={source:"asp-tag",event:"update-context",payload:{sessionData:this.environmentService.getSessionData(),attributionHistory:this.environmentService.getAttributionHistory(),accumulatedAttribution:this.environmentService.getAccumulatedAttribution(),pageUrl:window.location.href}};this.postMessage(t,e)}async handleMessage(t){var e,n,o,i,s,a;if(!this.trustedOrigins.includes(t.origin))return;const r=t.data;if("asp-chat"!==r.source)return;const l=t.source;if("request-context"===r.event)return(null===(e=r.payload)||void 0===e?void 0:e.qualification)&&this.conversionService.trackLead({qualification:r.payload.qualification,enhancedData:r.payload.enhancedConversionData}),void this.sendContext(l);if("submit"===r.event){const t=r.payload,e={formId:t.meta.formId,customerId:(null===(n=this.settingsService.getSettings())||void 0===n?void 0:n.customerId)||"",phone:t.meta.phone,name:t.meta.name||null,email:t.meta.email||null,formData:t.data,recaptchaToken:t.meta.recaptchaToken,qualification:t.meta.qualification,sessionData:(null===(o=t.context)||void 0===o?void 0:o.sessionData)||this.environmentService.getSessionData(),attributionHistory:(null===(i=t.context)||void 0===i?void 0:i.attributionHistory)||this.environmentService.getAttributionHistory(),accumulatedAttribution:(null===(s=t.context)||void 0===s?void 0:s.accumulatedAttribution)||this.environmentService.getAccumulatedAttribution(),pageUrl:(null===(a=t.context)||void 0===a?void 0:a.pageUrl)||window.location.href},c=await this.apiService.sendSubmission(e);!0===c?this.postMessage(l,{source:"asp-tag",event:"submit-success",payload:null}):"ALREADY_SUBMITTED_TODAY"===c?this.postMessage(l,{source:"asp-tag",event:"already_submitted_today"}):this.postMessage(l,{source:"asp-tag",event:"submit-error",payload:null})}}triggerWhatsApp(t){const e=null==t?void 0:t.replace(/[^0-9]/g,"");e&&window.open(`https://wa.me/${e}`,"_blank")}}class i{constructor(t){this.settingsService=t}trackLead(t){const e=t.qualification;if(!e||!e.isQualified)return;const n=e.score||0;this.trackGoogleAnalytics(n,t.enhancedData),this.trackFacebookPixel(n,t.enhancedData)}trackGoogleAnalytics(t,e){var n,o,i,s,a,r,l,c;if("function"==typeof window.gtag)try{e&&Object.keys(e).length>0&&(console.log("[Aspa Tag] Setting GTag User Data",e),window.gtag("set","user_data",e)),window.gtag("event",(null===(o=null===(n=this.settingsService.getSettings())||void 0===n?void 0:n.conversion)||void 0===o?void 0:o.eventName)||"generate_lead",{value:(null===(s=null===(i=this.settingsService.getSettings())||void 0===i?void 0:i.conversion)||void 0===s?void 0:s.defaultValue)||t,currency:(null===(r=null===(a=this.settingsService.getSettings())||void 0===a?void 0:a.conversion)||void 0===r?void 0:r.currency)||"BRL",event_source:(null===(c=null===(l=this.settingsService.getSettings())||void 0===l?void 0:l.conversion)||void 0===c?void 0:c.eventSource)||"aspa_chat"})}catch(t){console.error("[Aspa Tag] GTag Error:",t)}}trackFacebookPixel(t,e){var n;if("function"==typeof window.fbq)try{const o=null===(n=this.settingsService.getSettings())||void 0===n?void 0:n.conversion;let i=(null==o?void 0:o.eventName)||"Lead";"generate_lead"===i&&(i="Lead");const s={};(null==e?void 0:e.sha256_email_address)&&(s.em=e.sha256_email_address),(null==e?void 0:e.sha256_phone_number)&&(s.ph=e.sha256_phone_number),window.fbq("track",i,Object.assign({value:(null==o?void 0:o.defaultValue)||t,currency:(null==o?void 0:o.currency)||"BRL",content_name:(null==o?void 0:o.eventValue)||"Aspa Chat Lead"},s))}catch(t){console.error("[Aspa Tag] FBQ Error:",t)}}}function s(){}function a(t){return t()}function r(){return Object.create(null)}function l(t){t.forEach(a)}function c(t){return"function"==typeof t}function d(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let u,g;function f(t,e){return t===e||(u||(u=document.createElement("a")),u.href=e,t===u.href)}function h(t,e){t.appendChild(e)}function p(t,e,n){const o=function(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;if(e&&e.host)return e;return t.ownerDocument}(t);if(!o.getElementById(e)){const t=b("style");t.id=e,t.textContent=n,function(t,e){h(t.head||t,e),e.sheet}(o,t)}}function v(t,e,n){t.insertBefore(e,n||null)}function m(t){t.parentNode&&t.parentNode.removeChild(t)}function b(t){return document.createElement(t)}function y(t){return document.createTextNode(t)}function w(){return y(" ")}function x(){return y("")}function $(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function S(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function k(t,e,n){t.classList.toggle(e,!!n)}function _(t){g=t}function A(){if(!g)throw new Error("Function called outside component initialization");return g}function C(t){A().$$.on_mount.push(t)}function E(){const t=A();return(e,n,{cancelable:o=!1}={})=>{const i=t.$$.callbacks[e];if(i){const s=function(t,e,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:o})}(e,n,{cancelable:o});return i.slice().forEach(e=>{e.call(t,s)}),!s.defaultPrevented}return!0}}function O(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(t=>t.call(this,e))}const I=[],T=[];let D=[];const L=[],N=Promise.resolve();let M=!1;function z(t){D.push(t)}const B=new Set;let P=0;function U(){if(0!==P)return;const t=g;do{try{for(;P<I.length;){const t=I[P];P++,_(t),H(t.$$)}}catch(t){throw I.length=0,P=0,t}for(_(null),I.length=0,P=0;T.length;)T.pop()();for(let t=0;t<D.length;t+=1){const e=D[t];B.has(e)||(B.add(e),e())}D.length=0}while(I.length);for(;L.length;)L.pop()();M=!1,B.clear(),_(t)}function H(t){if(null!==t.fragment){t.update(),l(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(z)}}const R=new Set;let j;function Y(){j={r:0,c:[],p:j}}function q(){j.r||l(j.c),j=j.p}function V(t,e){t&&t.i&&(R.delete(t),t.i(e))}function F(t,e,n,o){if(t&&t.o){if(R.has(t))return;R.add(t),j.c.push(()=>{R.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}else o&&o()}function K(t){return void 0!==t?.length?t:Array.from(t)}function W(t,e){t.d(1),e.delete(t.key)}function J(t){t&&t.c()}function G(t,e,n){const{fragment:o,after_update:i}=t.$$;o&&o.m(e,n),z(()=>{const e=t.$$.on_mount.map(a).filter(c);t.$$.on_destroy?t.$$.on_destroy.push(...e):l(e),t.$$.on_mount=[]}),i.forEach(z)}function Q(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];D.forEach(o=>-1===t.indexOf(o)?e.push(o):n.push(o)),n.forEach(t=>t()),D=e}(n.after_update),l(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function X(t,e){-1===t.$$.dirty[0]&&(I.push(t),M||(M=!0,N.then(U)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Z(t,e,n,o,i,a,c=null,d=[-1]){const u=g;_(t);const f=t.$$={fragment:null,ctx:[],props:a,update:s,not_equal:i,bound:r(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:r(),dirty:d,skip_bound:!1,root:e.target||u.$$.root};c&&c(f.root);let h=!1;if(f.ctx=n?n(t,e.props||{},(e,n,...o)=>{const s=o.length?o[0]:n;return f.ctx&&i(f.ctx[e],f.ctx[e]=s)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](s),h&&X(t,e)),n}):[],f.update(),h=!0,l(f.before_update),f.fragment=!!o&&o(f.ctx),e.target){if(e.hydrate){const t=function(t){return Array.from(t.childNodes)}(e.target);f.fragment&&f.fragment.l(t),t.forEach(m)}else f.fragment&&f.fragment.c();e.intro&&V(t.$$.fragment),G(t,e.target,e.anchor),U()}_(u)}class tt{$$=void 0;$$set=void 0;$destroy(){Q(this,1),this.$destroy=s}$on(t,e){if(!c(e))return s;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");class et{constructor(t){this.settingsService=t,this.openCallback=null}setOpenHandler(t){this.openCallback=t}init(){window.Aspa={open:t=>{this.openCallback&&t?this.openCallback(t):console.warn(`Aspa Chat: Config '${t}' not found.`)}},document.addEventListener("click",t=>{const e=this.settingsService.getSettings();if(!e||!this.openCallback)return;const n=t.target;for(const[o,i]of Object.entries(e.configurations)){if(!i.triggerSelector)continue;if(n.closest(i.triggerSelector))return t.preventDefault(),void this.openCallback(o)}})}}function nt(t){p(t,"svelte-1n9mad7",".aspa-button.svelte-1n9mad7{position:fixed;bottom:var(--position-bottom);right:var(--position-right);left:var(--position-left);z-index:2147483647;width:60px;height:60px;background-color:var(--button-bg-color);color:var(--button-icon-color);border-radius:50%;border:none;box-shadow:0 4px 12px rgba(0, 0, 0, 0.2);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform 0.2s ease-out, background-color 0.2s ease-out, color 0.2s ease-out}.aspa-button.svelte-1n9mad7:hover{transform:scale(1.05)}.aspa-icon.svelte-1n9mad7{width:32px;height:32px}")}function ot(t){let e,n,o,i,a;return{c(){e=b("button"),n=b("div"),n.innerHTML='<svg fill="currentColor" width="32px" height="32px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg"><title>whatsapp</title><path d="M26.576 5.363c-2.69-2.69-6.406-4.354-10.511-4.354-8.209 0-14.865 6.655-14.865 14.865 0 2.732 0.737 5.291 2.022 7.491l-0.038-0.070-2.109 7.702 7.879-2.067c2.051 1.139 4.498 1.809 7.102 1.809h0.006c8.209-0.003 14.862-6.659 14.862-14.868 0-4.103-1.662-7.817-4.349-10.507l0 0zM16.062 28.228h-0.005c-0 0-0.001 0-0.001 0-2.319 0-4.489-0.64-6.342-1.753l0.056 0.031-0.451-0.267-4.675 1.227 1.247-4.559-0.294-0.467c-1.185-1.862-1.889-4.131-1.889-6.565 0-6.822 5.531-12.353 12.353-12.353s12.353 5.531 12.353 12.353c0 6.822-5.53 12.353-12.353 12.353h-0zM22.838 18.977c-0.371-0.186-2.197-1.083-2.537-1.208-0.341-0.124-0.589-0.185-0.837 0.187-0.246 0.371-0.958 1.207-1.175 1.455-0.216 0.249-0.434 0.279-0.805 0.094-1.15-0.466-2.138-1.087-2.997-1.852l0.010 0.009c-0.799-0.74-1.484-1.587-2.037-2.521l-0.028-0.052c-0.216-0.371-0.023-0.572 0.162-0.757 0.167-0.166 0.372-0.434 0.557-0.65 0.146-0.179 0.271-0.384 0.366-0.604l0.006-0.017c0.043-0.087 0.068-0.188 0.068-0.296 0-0.131-0.037-0.253-0.101-0.357l0.002 0.003c-0.094-0.186-0.836-2.014-1.145-2.758-0.302-0.724-0.609-0.625-0.836-0.637-0.216-0.010-0.464-0.012-0.712-0.012-0.395 0.010-0.746 0.188-0.988 0.463l-0.001 0.002c-0.802 0.761-1.3 1.834-1.3 3.023 0 0.026 0 0.053 0.001 0.079l-0-0.004c0.131 1.467 0.681 2.784 1.527 3.857l-0.012-0.015c1.604 2.379 3.742 4.282 6.251 5.564l0.094 0.043c0.548 0.248 1.25 0.513 1.968 0.74l0.149 0.041c0.442 0.14 0.951 0.221 1.479 0.221 0.303 0 0.601-0.027 0.889-0.078l-0.031 0.004c1.069-0.223 1.956-0.868 2.497-1.749l0.009-0.017c0.165-0.366 0.261-0.793 0.261-1.242 0-0.185-0.016-0.366-0.047-0.542l0.003 0.019c-0.092-0.155-0.34-0.247-0.712-0.434z"></path></svg>',S(n,"class","aspa-icon svelte-1n9mad7"),S(e,"class","aspa-button svelte-1n9mad7"),S(e,"style",t[1]),S(e,"aria-label",o=t[0]?"Close chat form":"Open chat form"),k(e,"is-open",t[0])},m(o,s){v(o,e,s),h(e,n),i||(a=$(e,"click",t[5]),i=!0)},p(t,[n]){2&n&&S(e,"style",t[1]),1&n&&o!==(o=t[0]?"Close chat form":"Open chat form")&&S(e,"aria-label",o),1&n&&k(e,"is-open",t[0])},i:s,o:s,d(t){t&&m(e),i=!1,a()}}}function it(t,e,n){let o,i,s,{config:a}=e,{isOpen:r=!1}=e;return t.$$set=t=>{"config"in t&&n(2,a=t.config),"isOpen"in t&&n(0,r=t.isOpen)},t.$$.update=()=>{5&t.$$.dirty&&n(4,o=r?a.styles.iconColor:a.styles.buttonColor),5&t.$$.dirty&&n(3,i=r?a.styles.buttonColor:a.styles.iconColor),24&t.$$.dirty&&n(1,s=`\n    --button-bg-color: ${o};\n    --button-icon-color: ${i};\n    --position-bottom: 20px;\n    --position-right: 20px;\n    --position-left: auto;\n  `)},[r,s,a,i,o,function(e){O.call(this,t,e)}]}class st extends tt{constructor(t){super(),Z(this,t,it,ot,d,{config:2,isOpen:0},nt)}}function at(t){p(t,"svelte-syzvif",".aspa-dialog-overlay.svelte-syzvif{position:fixed;top:0;left:0;width:100%;height:100%;z-index:99999999;display:flex;background:rgba(0, 0, 0, 0.5);align-items:center;justify-content:center;pointer-events:auto;visibility:hidden;opacity:0;transition:opacity 0.3s ease, visibility 0.3s ease}.aspa-dialog-overlay.is-open.svelte-syzvif{visibility:visible;opacity:1}.aspa-dialog-overlay.svelte-syzvif:not(.modal){align-items:flex-end;justify-content:flex-end}.aspa-dialog-content.svelte-syzvif{background:var(--modal-bg-color);border-radius:var(--modal-border-radius);box-shadow:0 10px 30px rgba(0, 0, 0, 0.2);position:relative;overflow:hidden;pointer-events:auto;width:90vw;max-width:400px;height:70vh;max-height:600px;margin:20px;margin-bottom:90px;display:flex;flex-direction:column;transition:all 0.3s ease}.aspa-dialog-close.svelte-syzvif{position:absolute;top:0;right:0;width:44px;height:44px;padding:0;font-size:24px;color:#aaa;background:none;border:none;cursor:pointer;z-index:10;display:flex;align-items:center;justify-content:center;transform:translate(5px, -5px)}.aspa-dialog-close.svelte-syzvif:hover{color:#333}@media(max-width: 600px){.aspa-dialog-content.svelte-syzvif{width:100vw;max-width:100vw;max-height:100dvh;height:100dvh;margin:0;border-radius:0}}.aspa-iframe.svelte-syzvif{flex-grow:1;width:100%;height:100%;border:none}.aspa-iframe.hidden.svelte-syzvif{display:none}")}function rt(t,e,n){const o=t.slice();return o[8]=e[n],o}function lt(t,e){let n,o,i,s,a;return{key:t,first:null,c(){n=b("iframe"),f(n.src,o=`${dt}/${e[8]}`)||S(n,"src",o),S(n,"class","aspa-iframe svelte-syzvif"),S(n,"frameborder","0"),S(n,"title",i=`Aspa Chat Form ${e[8]}`),k(n,"hidden",e[8]!==e[1].formId),this.first=n},m(t,o){v(t,n,o),s||(a=$(n,"load",e[4]),s=!0)},p(t,s){e=t,4&s&&!f(n.src,o=`${dt}/${e[8]}`)&&S(n,"src",o),4&s&&i!==(i=`Aspa Chat Form ${e[8]}`)&&S(n,"title",i),6&s&&k(n,"hidden",e[8]!==e[1].formId)},d(t){t&&m(n),s=!1,a()}}}function ct(t){let e,n,o,i,a,r,c=[],d=new Map,u=K(t[2]);const g=t=>t[8];for(let e=0;e<u.length;e+=1){let n=rt(t,u,e),o=g(n);d.set(o,c[e]=lt(o,n))}return{c(){e=b("div"),n=b("div"),o=b("button"),o.textContent="Ã—",i=w();for(let t=0;t<c.length;t+=1)c[t].c();S(o,"class","aspa-dialog-close svelte-syzvif"),S(o,"aria-label","Close dialog"),S(n,"class","aspa-dialog-content svelte-syzvif"),S(n,"style",t[3]),S(e,"class","aspa-dialog-overlay svelte-syzvif"),k(e,"is-open",t[0]),k(e,"modal","modal"===t[1].dialogType)},m(s,l){v(s,e,l),h(e,n),h(n,o),h(n,i);for(let t=0;t<c.length;t+=1)c[t]&&c[t].m(n,null);var d;a||(r=[$(o,"click",t[5]),$(n,"click",(d=t[6],function(t){return t.stopPropagation(),d.call(this,t)})),$(e,"click",t[5])],a=!0)},p(t,[o]){22&o&&(u=K(t[2]),c=function(t,e,n,o,i,s,a,r,c,d,u,g){let f=t.length,h=s.length,p=f;const v={};for(;p--;)v[t[p].key]=p;const m=[],b=new Map,y=new Map,w=[];for(p=h;p--;){const t=g(i,s,p),o=n(t);let r=a.get(o);r?w.push(()=>r.p(t,e)):(r=d(o,t),r.c()),b.set(o,m[p]=r),o in v&&y.set(o,Math.abs(p-v[o]))}const x=new Set,$=new Set;function S(t){V(t,1),t.m(r,u),a.set(t.key,t),u=t.first,h--}for(;f&&h;){const e=m[h-1],n=t[f-1],o=e.key,i=n.key;e===n?(u=e.first,f--,h--):b.has(i)?!a.has(o)||x.has(o)?S(e):$.has(i)?f--:y.get(o)>y.get(i)?($.add(o),S(e)):(x.add(i),f--):(c(n,a),f--)}for(;f--;){const e=t[f];b.has(e.key)||c(e,a)}for(;h;)S(m[h-1]);return l(w),m}(c,o,g,0,t,u,d,n,W,lt,null,rt)),8&o&&S(n,"style",t[3]),1&o&&k(e,"is-open",t[0]),2&o&&k(e,"modal","modal"===t[1].dialogType)},i:s,o:s,d(t){t&&m(e);for(let t=0;t<c.length;t+=1)c[t].d();a=!1,l(r)}}}const dt="https://aspa-form.web.app";function ut(t,e,n){let o,{isOpen:i=!1}=e,{config:s}=e;const a=E();let r=[];function l(){a("close")}return C(()=>{const t=t=>{"Escape"===t.key&&i&&l()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)}),t.$$set=t=>{"isOpen"in t&&n(0,i=t.isOpen),"config"in t&&n(1,s=t.config)},t.$$.update=()=>{2&t.$$.dirty&&n(3,o=`\n    --modal-bg-color: ${s.styles.modalColor};\n    --modal-border-radius: ${s.styles.borderRadius};\n  `),7&t.$$.dirty&&i&&s.formId&&(r.includes(s.formId)||n(2,r=[...r,s.formId]))},[i,s,r,o,function(t){const e=t.target;e&&e.contentWindow&&a("load",{iframeWindow:e.contentWindow})},l,function(e){O.call(this,t,e)}]}class gt extends tt{constructor(t){super(),Z(this,t,ut,ct,d,{isOpen:0,config:1},at)}}function ft(t){p(t,"svelte-8horpe",".aspa-branding.svelte-8horpe{position:fixed;bottom:0;right:0;z-index:2147483646;font-size:12px;font-family:-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;text-decoration:none;color:#333;white-space:nowrap;background:transparent;padding:2px 6px;border-radius:0;opacity:0.3;transition:opacity 0.2s ease}.aspa-branding.svelte-8horpe:hover{opacity:1}.aspa-branding.svelte-8horpe::before{content:'?'}.aspa-branding.svelte-8horpe:hover::before{content:'Powered by Aspa Chat'}")}function ht(t){let e;return{c(){e=b("a"),S(e,"href",t[0]),S(e,"class","aspa-branding svelte-8horpe"),S(e,"target","_blank"),S(e,"rel","noopener noreferrer"),S(e,"aria-label","Powered by Aspa Chat")},m(t,n){v(t,e,n)},p:s,i:s,o:s,d(t){t&&m(e)}}}function pt(t){return[`https://aspa.chat?utm_medium=${window.location.hostname}&utm_source=whatsapp button`]}class vt extends tt{constructor(t){super(),Z(this,t,pt,ht,d,{},ft)}}function mt(t){p(t,"svelte-eg7y2u",'#aspa-widget-root{font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;box-sizing:border-box;font-size:16px}#aspa-widget-root *, #aspa-widget-root *::before, #aspa-widget-root *::after{box-sizing:inherit}')}function bt(t){let e,n;return e=new st({props:{config:t[3].floatingButton,isOpen:t[0]&&t[1]===t[3].floatingButton}}),e.$on("click",t[5]),{c(){J(e.$$.fragment)},m(t,o){G(e,t,o),n=!0},p(t,n){const o={};3&n&&(o.isOpen=t[0]&&t[1]===t[3].floatingButton),e.$set(o)},i(t){n||(V(e.$$.fragment,t),n=!0)},o(t){F(e.$$.fragment,t),n=!1},d(t){Q(e,t)}}}function yt(t){let e,n;return e=new gt({props:{isOpen:t[0],config:t[1]}}),e.$on("close",t[8]),e.$on("load",t[4]),{c(){J(e.$$.fragment)},m(t,o){G(e,t,o),n=!0},p(t,n){const o={};1&n&&(o.isOpen=t[0]),2&n&&(o.config=t[1]),e.$set(o)},i(t){n||(V(e.$$.fragment,t),n=!0)},o(t){F(e.$$.fragment,t),n=!1},d(t){Q(e,t)}}}function wt(t){let e,n,o=t[3]&&function(t){let e,n,o,i,s;e=new vt({});let a=t[3].floatingButton&&t[2]&&bt(t),r=t[1]&&yt(t);return{c(){J(e.$$.fragment),n=w(),a&&a.c(),o=w(),r&&r.c(),i=x()},m(t,l){G(e,t,l),v(t,n,l),a&&a.m(t,l),v(t,o,l),r&&r.m(t,l),v(t,i,l),s=!0},p(t,e){t[3].floatingButton&&t[2]?a?(a.p(t,e),4&e&&V(a,1)):(a=bt(t),a.c(),V(a,1),a.m(o.parentNode,o)):a&&(Y(),F(a,1,1,()=>{a=null}),q()),t[1]?r?(r.p(t,e),2&e&&V(r,1)):(r=yt(t),r.c(),V(r,1),r.m(i.parentNode,i)):r&&(Y(),F(r,1,1,()=>{r=null}),q())},i(t){s||(V(e.$$.fragment,t),V(a),V(r),s=!0)},o(t){F(e.$$.fragment,t),F(a),F(r),s=!1},d(t){t&&(m(n),m(o),m(i)),Q(e,t),a&&a.d(t),r&&r.d(t)}}}(t);return{c(){o&&o.c(),e=x()},m(t,i){o&&o.m(t,i),v(t,e,i),n=!0},p(t,[e]){t[3]&&o.p(t,e)},i(t){n||(V(o),n=!0)},o(t){F(o),n=!1},d(t){t&&m(e),o&&o.d(t)}}}function xt(t,e,n){let{settingsService:o}=e,{messagingService:i}=e;const s=new et(o),a=o.getSettings();let r=!1,l=(null==a?void 0:a.floatingButton)||null;function c(t){const e=o.getConfig(t);e?r&&l===e?n(0,r=!1):(n(1,l=e),n(0,r=!0)):console.warn(`Aspa Chat: Config '${t}' not found.`)}let d=!1;C(()=>{if(a&&a.floatingButton){const t=a.floatingButton.delay||0;t>0?setTimeout(()=>{n(2,d=!0)},t):n(2,d=!0)}s.setOpenHandler(c),s.init();const t=()=>{n(0,r=!1)};return window.addEventListener("aspa:close-dialog",t),()=>window.removeEventListener("aspa:close-dialog",t)});return t.$$set=t=>{"settingsService"in t&&n(6,o=t.settingsService),"messagingService"in t&&n(7,i=t.messagingService)},[r,l,d,a,function(t){const e=t.detail.iframeWindow;i.setModalIframe(e),l&&(i.sendInitialConfig(e,l.fallback.phoneNumber,l.fallback.message,l.styles.buttonColor),i.sendContext(e))},function(){(null==a?void 0:a.floatingButton)&&(r&&l===a.floatingButton?n(0,r=!1):(n(1,l=a.floatingButton),n(0,r=!0)))},o,i,()=>n(0,r=!1)]}class $t extends tt{constructor(t){super(),Z(this,t,xt,wt,d,{settingsService:6,messagingService:7},mt)}}function St(){const s=new t;if(!s.getSettings())return;const a=new e;a.init();const r=new n,l=new i(s),c=new o(r,a,s,l);c.init();const d=document.createElement("div");d.id="aspa-widget-root",document.body.appendChild(d),new $t({target:d,props:{settingsService:s,messagingService:c}})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",St):St()}();
